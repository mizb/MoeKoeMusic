import Store from 'electron-store';
import { app } from 'electron';

const store = new Store();

const translations = {
  'zh-CN': {
    'project-home': '项目主页',
    'report-bug': '反馈bug',
    'prev-track': '上一首',
    'pause': '暂停',
    'play': '播放',
    'next-track': '下一首',
    'check-updates': '检查更新',
    'restart-app': '重启应用',
    'show-hide': '显示/隐藏',
    'quit': '退出程序',
    'no-lyrics': '暂无歌词',
    'desktop-lyrics-closed': '桌面歌词已关闭',
    'this-time-only': '仅本次生效',
    'now-playing': '正在播放：',
    'error': '错误',
    'init-error': '初始化应用时发生错误。',
    'api-error': 'API 服务启动失败，请检查！',
    'ok': '确定',
    'shortcut-failed': '快捷键注册失败，请重新尝试',
    'hint': '提示',
    'update-timeout': '更新服务器连接超时，请检查网络',
    'update-failed': '更新检查失败，请重试',
    'new-version': '发现新版本',
    'new-version-msg': '发现新版本 {version}\n\n{notes}',
    'no-release-notes': '暂无更新说明',
    'update-now': '立即更新',
    'later': '稍后提醒',
    'update-hint': '更新提示',
    'already-latest': '当前已是最新版本',
    'update-ready': '更新就绪',
    'update-ready-msg': '新版本已下载完成，立即安装？',
    'install-now': '现在安装',
    'install-later': '稍后安装',
    'non-windows-update': '非 Windows 平台暂不支持在线更新，请前往官网或应用市场下载最新版本。'
  },
  'zh-TW': {
    'project-home': '專案首頁',
    'report-bug': '回報問題',
    'prev-track': '上一首',
    'pause': '暫停',
    'play': '播放',
    'next-track': '下一首',
    'check-updates': '檢查更新',
    'restart-app': '重新啟動',
    'show-hide': '顯示/隱藏',
    'quit': '結束程式',
    'no-lyrics': '暫無歌詞',
    'desktop-lyrics-closed': '桌面歌詞已關閉',
    'this-time-only': '僅本次生效',
    'now-playing': '正在播放：',
    'error': '錯誤',
    'init-error': '初始化應用時發生錯誤。',
    'api-error': 'API 服務啟動失敗，請檢查！',
    'ok': '確定',
    'shortcut-failed': '快捷鍵註冊失敗，請重新嘗試',
    'hint': '提示',
    'update-timeout': '更新伺服器連接逾時，請檢查網絡',
    'update-failed': '更新檢查失敗，請重試',
    'new-version': '發現新版本',
    'new-version-msg': '發現新版本 {version}\n\n{notes}',
    'no-release-notes': '暫無更新說明',
    'update-now': '立即更新',
    'later': '稍後提醒',
    'update-hint': '更新提示',
    'already-latest': '當前已是最新版本',
    'update-ready': '更新就緒',
    'update-ready-msg': '新版本已下載完成，立即安裝？',
    'install-now': '現在安裝',
    'install-later': '稍後安裝',
    'non-windows-update': '非 Windows 平台暫不支持線上更新，請前往官網或應用市場下載最新版本。'
  },
  'en': {
    'project-home': 'Project Homepage',
    'report-bug': 'Report Bug',
    'prev-track': 'Previous',
    'pause': 'Pause',
    'play': 'Play',
    'next-track': 'Next',
    'check-updates': 'Check Updates',
    'restart-app': 'Restart App',
    'show-hide': 'Show/Hide',
    'quit': 'Quit',
    'no-lyrics': 'No Lyrics',
    'desktop-lyrics-closed': 'Desktop Lyrics Closed',
    'this-time-only': 'This session only',
    'now-playing': 'Now Playing: ',
    'error': 'Error',
    'init-error': 'Error initializing app.',
    'api-error': 'API service failed to start!',
    'ok': 'OK',
    'shortcut-failed': 'Shortcut registration failed',
    'hint': 'Notice',
    'update-timeout': 'Update server connection timeout',
    'update-failed': 'Update check failed',
    'new-version': 'New Version Available',
    'new-version-msg': 'New version {version} available\n\n{notes}',
    'no-release-notes': 'No release notes',
    'update-now': 'Update Now',
    'later': 'Later',
    'update-hint': 'Update',
    'already-latest': 'Already up to date',
    'update-ready': 'Update Ready',
    'update-ready-msg': 'Update downloaded. Install now?',
    'install-now': 'Install Now',
    'install-later': 'Later',
    'non-windows-update': 'Auto-update is only available on Windows. Please download from the official website.'
  },
  'ru': {
    'project-home': 'Страница проекта',
    'report-bug': 'Сообщить об ошибке',
    'prev-track': 'Предыдущий',
    'pause': 'Пауза',
    'play': 'Воспроизвести',
    'next-track': 'Следующий',
    'check-updates': 'Проверить обновления',
    'restart-app': 'Перезапустить',
    'show-hide': 'Показать/Скрыть',
    'quit': 'Выход',
    'no-lyrics': 'Нет текста',
    'desktop-lyrics-closed': 'Текст на рабочем столе скрыт',
    'this-time-only': 'Только для этого сеанса',
    'now-playing': 'Сейчас играет: ',
    'error': 'Ошибка',
    'init-error': 'Ошибка инициализации приложения.',
    'api-error': 'Не удалось запустить API!',
    'ok': 'ОК',
    'shortcut-failed': 'Не удалось зарегистрировать горячие клавиши',
    'hint': 'Уведомление',
    'update-timeout': 'Таймаут подключения к серверу обновлений',
    'update-failed': 'Ошибка проверки обновлений',
    'new-version': 'Доступна новая версия',
    'new-version-msg': 'Доступна версия {version}\n\n{notes}',
    'no-release-notes': 'Нет описания изменений',
    'update-now': 'Обновить',
    'later': 'Позже',
    'update-hint': 'Обновление',
    'already-latest': 'Установлена последняя версия',
    'update-ready': 'Обновление готово',
    'update-ready-msg': 'Обновление загружено. Установить сейчас?',
    'install-now': 'Установить',
    'install-later': 'Позже',
    'non-windows-update': 'Автообновление доступно только на Windows. Скачайте с официального сайта.'
  },
  'ja': {
    'project-home': 'プロジェクトホーム',
    'report-bug': 'バグ報告',
    'prev-track': '前の曲',
    'pause': '一時停止',
    'play': '再生',
    'next-track': '次の曲',
    'check-updates': '更新を確認',
    'restart-app': '再起動',
    'show-hide': '表示/非表示',
    'quit': '終了',
    'no-lyrics': '歌詞なし',
    'desktop-lyrics-closed': 'デスクトップ歌詞を閉じました',
    'this-time-only': '今回のみ有効',
    'now-playing': '再生中：',
    'error': 'エラー',
    'init-error': 'アプリの初期化エラー。',
    'api-error': 'APIサービスの起動に失敗しました！',
    'ok': 'OK',
    'shortcut-failed': 'ショートカット登録に失敗しました',
    'hint': '通知',
    'update-timeout': '更新サーバー接続タイムアウト',
    'update-failed': '更新確認に失敗しました',
    'new-version': '新しいバージョンが利用可能',
    'new-version-msg': 'バージョン {version} が利用可能です\n\n{notes}',
    'no-release-notes': 'リリースノートなし',
    'update-now': '今すぐ更新',
    'later': '後で',
    'update-hint': '更新',
    'already-latest': '最新バージョンです',
    'update-ready': '更新準備完了',
    'update-ready-msg': '更新がダウンロードされました。今すぐインストールしますか？',
    'install-now': '今すぐインストール',
    'install-later': '後で',
    'non-windows-update': '自動更新はWindowsでのみ利用可能です。公式サイトからダウンロードしてください。'
  },
  'ko': {
    'project-home': '프로젝트 홈',
    'report-bug': '버그 신고',
    'prev-track': '이전',
    'pause': '일시정지',
    'play': '재생',
    'next-track': '다음',
    'check-updates': '업데이트 확인',
    'restart-app': '재시작',
    'show-hide': '표시/숨기기',
    'quit': '종료',
    'no-lyrics': '가사 없음',
    'desktop-lyrics-closed': '바탕화면 가사 닫힘',
    'this-time-only': '이번 세션만',
    'now-playing': '재생 중: ',
    'error': '오류',
    'init-error': '앱 초기화 오류.',
    'api-error': 'API 서비스 시작 실패!',
    'ok': '확인',
    'shortcut-failed': '단축키 등록 실패',
    'hint': '알림',
    'update-timeout': '업데이트 서버 연결 시간 초과',
    'update-failed': '업데이트 확인 실패',
    'new-version': '새 버전 사용 가능',
    'new-version-msg': '버전 {version} 사용 가능\n\n{notes}',
    'no-release-notes': '릴리스 노트 없음',
    'update-now': '지금 업데이트',
    'later': '나중에',
    'update-hint': '업데이트',
    'already-latest': '최신 버전입니다',
    'update-ready': '업데이트 준비 완료',
    'update-ready-msg': '업데이트가 다운로드되었습니다. 지금 설치하시겠습니까?',
    'install-now': '지금 설치',
    'install-later': '나중에',
    'non-windows-update': '자동 업데이트는 Windows에서만 사용 가능합니다. 공식 웹사이트에서 다운로드하세요.'
  }
};

function getLocale() {
  // First check user settings
  const settings = store.get('settings');
  if (settings?.language) {
    return settings.language;
  }
  // Otherwise use system language
  const systemLang = app.getLocale();
  if (systemLang.startsWith('zh')) {
    return systemLang === 'zh-TW' || systemLang === 'zh-HK' ? 'zh-TW' : 'zh-CN';
  }
  if (systemLang.startsWith('ru')) return 'ru';
  if (systemLang.startsWith('ja')) return 'ja';
  if (systemLang.startsWith('ko')) return 'ko';
  if (systemLang.startsWith('en')) return 'en';
  return 'zh-CN'; // fallback
}

export function t(key) {
  const locale = getLocale();
  return translations[locale]?.[key] || translations['zh-CN']?.[key] || key;
}

export default { t };
